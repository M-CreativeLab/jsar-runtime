<html>

<head>
  <meta charset="utf-8" />
  <title>WebXR APIs</title>
  <script>
    console.info(navigator.xr);
    setTimeout(async () => {
      try {
        const requestMode = 'immersive-ar';
        const supports = await navigator.xr.isSessionSupported(requestMode);
        if (supports) {
          const newSession = await navigator.xr.requestSession(requestMode);
          newSession.addEventListener('inputsourceschange', e => {
            console.info('inputsourceschange', e);
          });
          console.info(newSession);
          const baseLayer = new XRWebGLLayer(newSession, navigator.gl);
          newSession.updateRenderState({ baseLayer });
          console.info(newSession, baseLayer);

          const baseReferenceSpace = await newSession.requestReferenceSpace('local');
          // function renderloop(time, frame) {
          //   newSession.requestAnimationFrame(renderloop);

          //   const viewerPose = frame.getViewerPose(baseReferenceSpace);
          //   console.info(viewerPose.transform);
          //   console.info(viewerPose.views.map(view => view.transform));
          // }
          // newSession.requestAnimationFrame(renderloop);
        }
      } catch (err) {
        console.error(err);
      }
    }, 0);
  </script>
</head>

<body>
</body>

</html>